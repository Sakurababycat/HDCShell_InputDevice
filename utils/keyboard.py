import os
import pygame

KEYMAP = {
    pygame.K_0: 2000,
    pygame.K_1: 2001,
    pygame.K_2: 2002,
    pygame.K_3: 2003,
    pygame.K_4: 2004,
    pygame.K_5: 2005,
    pygame.K_6: 2006,
    pygame.K_7: 2007,
    pygame.K_8: 2008,
    pygame.K_9: 2009,
    pygame.K_ASTERISK: 2010,
    pygame.K_HASH: 2011,
    pygame.K_UP: 2012,
    pygame.K_DOWN: 2013,
    pygame.K_LEFT: 2014,
    pygame.K_RIGHT: 2015,
    pygame.K_RETURN: 2016,
    pygame.K_a: 2017,
    pygame.K_b: 2018,
    pygame.K_c: 2019,
    pygame.K_d: 2020,
    pygame.K_e: 2021,
    pygame.K_f: 2022,
    pygame.K_g: 2023,
    pygame.K_h: 2024,
    pygame.K_i: 2025,
    pygame.K_j: 2026,
    pygame.K_k: 2027,
    pygame.K_l: 2028,
    pygame.K_m: 2029,
    pygame.K_n: 2030,
    pygame.K_o: 2031,
    pygame.K_p: 2032,
    pygame.K_q: 2033,
    pygame.K_r: 2034,
    pygame.K_s: 2035,
    pygame.K_t: 2036,
    pygame.K_u: 2037,
    pygame.K_v: 2038,
    pygame.K_w: 2039,
    pygame.K_x: 2040,
    pygame.K_y: 2041,
    pygame.K_z: 2042,
    pygame.K_COMMA: 2043,
    pygame.K_PERIOD: 2044,
    pygame.K_LALT: 2045,
    pygame.K_RALT: 2046,
    pygame.K_LSHIFT: 2047,
    pygame.K_RSHIFT: 2048,
    pygame.K_TAB: 2049,
    pygame.K_SPACE: 2050,
    pygame.K_RETURN: 2054,
    pygame.K_BACKSPACE: 2055,
    pygame.K_BACKQUOTE: 2056,
    pygame.K_MINUS: 2057,
    pygame.K_EQUALS: 2058,
    pygame.K_LEFTBRACKET: 2059,
    pygame.K_RIGHTBRACKET: 2060,
    pygame.K_BACKSLASH: 2061,
    pygame.K_SEMICOLON: 2062,
    pygame.K_QUOTE: 2063,
    pygame.K_SLASH: 2064,
    pygame.K_AT: 2065,
    pygame.K_PLUS: 2066,
    pygame.K_MENU: 2067,
    pygame.K_PAGEUP: 2068,
    pygame.K_PAGEDOWN: 2069,
    pygame.K_ESCAPE: 2070,
    pygame.K_DELETE: 2071,
    pygame.K_LCTRL: 2072,
    pygame.K_RCTRL: 2073,
    pygame.K_CAPSLOCK: 2074,
    pygame.K_SCROLLOCK: 2075,
    pygame.K_LMETA: 2076,
    pygame.K_RMETA: 2077,
    pygame.K_MODE: 2078,
    pygame.K_SYSREQ: 2079,
    pygame.K_BREAK: 2080,
    pygame.K_HOME: 2081,
    pygame.K_END: 2082,
    pygame.K_INSERT: 2083,
    pygame.K_F1: 2090,
    pygame.K_F2: 2091,
    pygame.K_F3: 2092,
    pygame.K_F4: 2093,
    pygame.K_F5: 2094,
    pygame.K_F6: 2095,
    pygame.K_F7: 2096,
    pygame.K_F8: 2097,
    pygame.K_F9: 2098,
    pygame.K_F10: 2099,
    pygame.K_F11: 2100,
    pygame.K_F12: 2101,
    pygame.K_NUMLOCK: 2102,
    pygame.K_KP0: 2103,
    pygame.K_KP1: 2104,
    pygame.K_KP2: 2105,
    pygame.K_KP3: 2106,
    pygame.K_KP4: 2107,
    pygame.K_KP5: 2108,
    pygame.K_KP6: 2109,
    pygame.K_KP7: 2110,
    pygame.K_KP8: 2111,
    pygame.K_KP9: 2112,
    pygame.K_KP_DIVIDE: 2113,
    pygame.K_KP_MULTIPLY: 2114,
    pygame.K_KP_MINUS: 2115,
    pygame.K_KP_PLUS: 2116,
    pygame.K_KP_PERIOD: 2117,
    pygame.K_COMMA: 2118,
    pygame.K_KP_ENTER: 2119,
    pygame.K_KP_EQUALS: 2120,
    pygame.K_LEFTPAREN: 2121,
    pygame.K_RIGHTPAREN: 2122,
    # pygame.K_FORWARD: 2084,
    # pygame.K_PLAY: 2085,
    # pygame.K_PAUSE: 2086,
    # pygame.K_CLOSE: 2087,
    # pygame.K_EJECT: 2088,
    # pygame.K_RECORD: 2089,
}
COMMON_REFIX = 'hdc shell uinput -K '
pressed = {key: False for key in KEYMAP.keys()}
pressed_cnt = 0


def handleKeyDown(key):
    global pressed_cnt
    pressed[key] = True
    pressed_cnt += 1
    # os.system(COMMON_REFIX + f' -d {KEYMAP.get(key, -1)}')


def handleKeyUp(key):
    global pressed_cnt
    if pressed_cnt == 0 or not pressed[key]:
        return

    command = " ".join([f"-d {KEYMAP.get(k, -1)}" for k, value in pressed.items()
                        if value and k != key]) + f" -d {KEYMAP.get(key, -1)}" + f" -u {KEYMAP.get(key, -1)}"
    print(COMMON_REFIX + command)
    os.system(COMMON_REFIX + command)
    pressed[key] = False
    pressed_cnt -= 1
